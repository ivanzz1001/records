---
layout: post
title: ansible-playbook ä¸åŒä½ç½®å®šä¹‰çš„å˜é‡
tags:
- ansible
categories: ansible
description: aansible-playbook ä¸åŒä½ç½®å®šä¹‰çš„å˜é‡
---

å˜é‡åœ¨ Ansible é‡Œå¯ä»¥å®šä¹‰åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œä½†å®ƒä»¬æœ‰ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå˜é‡è¦†ç›–çš„é¡ºåºæ˜¯æœ‰è§„åˆ™çš„ã€‚



<!-- more -->


# 1. Ansible å˜é‡ä¼˜å…ˆçº§ä»é«˜åˆ°ä½å¦‚ä¸‹ï¼ˆç”±é«˜åˆ°ä½ï¼‰

```text
ä¼˜å…ˆçº§        ä½ç½®                                            ç¤ºä¾‹
--------------------------------------------------------------------------------------------------------------
1(æœ€é«˜)       å‘½ä»¤è¡Œå‚æ•°	                                    -e "var=value"
2            task å±‚çº§ä¸­è®¾ç½®çš„å˜é‡                             vars: ä¸­æˆ– set_fact
3            block ä¸­å®šä¹‰çš„å˜é‡
4            play ä¸­å®šä¹‰çš„å˜é‡                                vars: æˆ– vars_files:
5            ä¸»æœºå˜é‡ï¼ˆinventoryï¼‰                            host_vars/hostname.yml æˆ– inventory æ–‡ä»¶ä¸­çš„å˜é‡
6            ç»„å˜é‡ï¼ˆinventoryï¼‰                              group_vars/web.yml ç­‰
7            è§’è‰²å˜é‡ï¼ˆroles/xxx/vars/main.ymlï¼‰
8            è§’è‰²é»˜è®¤å˜é‡ï¼ˆroles/xxx/defaults/main.ymlï¼‰
9(æœ€ä½)       Ansible å†…ç½®é»˜è®¤å€¼                               module é»˜è®¤å€¼ã€ç³»ç»Ÿé»˜è®¤å˜é‡ç­‰
```

**ç®€å•è®°å¿†å£è¯€:**

    å‘½ä»¤è¡Œæœ€å¤§ï¼Œè§’è‰²é»˜è®¤æœ€å°ã€‚è¿‘çš„è¦†ç›–è¿œçš„

# 2. ä¸¾ä¾‹

ä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡ app_portï¼š

- roles/myapp/defaults/main.yml â†’ app_port: 8080

- group_vars/web.yml â†’ app_port: 8081

- host_vars/web1.yml â†’ app_port: 8082

- playbook é‡Œå†™äº† vars: app_port: 8083

- å‘½ä»¤è¡Œæ‰§è¡ŒåŠ äº† -e app_port=8084

é‚£ä¹ˆæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯ï¼šğŸ‘‰ 8084

# 3. ğŸ’¡ å¸¸è§å†²çªè¯´æ˜ï¼š

- å¦‚æœä½ åœ¨å¤šä¸ªåœ°æ–¹å®šä¹‰äº†åŒä¸€ä¸ªå˜é‡åï¼ŒAnsible ä¼šå– ä¼˜å…ˆçº§é«˜çš„é‚£ä¸ªã€‚

- `-e` çš„å‘½ä»¤è¡Œå‚æ•°æ˜¯æœ€é«˜çš„ï¼Œå¯ä»¥å¼ºåˆ¶è¦†ç›–ä¸€åˆ‡ï¼Œå¸¸ç”¨äºè°ƒè¯•æˆ–ä¸´æ—¶è°ƒæ•´é…ç½®ã€‚

# 4. å…³äºblockä¸­å®šä¹‰çš„å˜é‡

å…³äºblockä¸­å®šä¹‰çš„å˜é‡ï¼Œä¸¾ä¾‹å¦‚ä¸‹:

```text
- hosts: all
  vars:
    my_var: "Play level"
  tasks:
    - name: Outside block
      debug:
        msg: "Outside block: {{ my_var }}"

    - block:
        - name: Inside block
          debug:
            msg: "Inside block: {{ my_var }}"
      vars:
        my_var: "Block level"
```

è¾“å‡ºç»“æœä¸º:

```text
Outside block: Play level
Inside block: Block level
```



<br />
<br />
<br />
